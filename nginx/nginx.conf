# Nginx acts as a TCP-level load balancer for the rates-service instances

events { # Configures event processing; default settings suffice for low traffic
  worker_connections 1024; # Maximum simultaneous connections per worker
}

http { # HTTP context for defining upstreams and servers
  upstream rates_backend { # Declares an upstream group named 'rates_backend'
    server rates-service-1:8082; # First rates-service instance
    server rates-service-2:8082; # Second rates-service instance
  }

  server { # Defines an HTTP server that proxies to the upstream
    listen 8080; # Listens on port 8080 for incoming requests

    location / { # For all request paths
      proxy_pass http://rates_backend; # Proxies requests to the upstream group
      proxy_set_header Host $host; # Preserves original Host header
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # Forwards client IPs
      proxy_set_header X-Forwarded-Proto $scheme; # Forwards original protocol (http/https)
    }
  }
}

